<!doctype html>
<html lang=en>
<head>
<title>FGx Terrain ~ 3D Flatland Demo</title>
<meta charset=utf-8>
</head>
<body>
<script src = http://mrdoob.github.io/three.js/build/three.min.js ></script>
<script src = http://mrdoob.github.io/three.js/examples/js/controls/TrackballControls.js ></script>
<script>
	var renderer, scene, camera, controls, heightMap;

	var UF = UF || {};
	UF.terrains = new THREE.Object3D();

	init();
	animate();

	function init() {
		document.body.style.cssText = 'margin: 0; overflow: hidden; }';

		renderer = new THREE.WebGLRenderer( { alpha: 1, antialias: true, clearColor: 0xffffff }  );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );
		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
		camera.position.set( 0, 300, 80 );
		controls = new THREE.TrackballControls( camera, renderer.domElement );

		heightMap = document.createElement('img' )
		heightMap.src =  '../../terrain/7+/' + ( 20 + 0 ) + '/' + ( 49 + 0 ) +'.png';
		heightMap.onload = initCanvas;

		scene.add( UF.terrains );
	}

	function initCanvas() {
		var canvas = document.createElement( 'canvas' );
		canvas.width = canvas.height = 1201;
		var context = canvas.getContext( '2d' );
		context.drawImage( heightMap, 0, 0, heightMap.width, heightMap.height, 0, 0, 256, 256 );
		var imgd = context.getImageData( 0, 0, 256, 256 );
		var pix = imgd.data;

		var material = new THREE.MeshNormalMaterial( { shading: THREE.SmoothShading } );
		var geometry = new THREE.PlaneGeometry( 200, 200, 255, 255);
		geometry.applyMatrix( new THREE.Matrix4().makeRotationX( -0.5 * Math.PI ) );
		var verts = geometry.vertices, all, j = 0;
		for (var i = 0, len = pix.length; i < len; i += 4) {
			all = pix[i] + pix[i + 1] + pix[i + 2];
			verts[j++].y = 0.2  * all;
		}
		var mesh = new THREE.Mesh( geometry, material );
		mesh.geometry.computeFaceNormals();
		mesh.geometry.computeVertexNormals();
		UF.terrains.add( mesh );
	}

	function animate() {
		requestAnimationFrame( animate );
		controls.update();
		renderer.render( scene, camera );
	}
</script>
</body>
</html>